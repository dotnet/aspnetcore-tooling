{
  "name": "ASP.NET Razor",
  "scopeName": "text.aspnetcorerazor",
  "patterns": [
    {
      "include": "#razor-control-structures"
    },
    {
      "include": "text.html.basic"
    }
  ],
  "repository": {
    "razor-control-structures": {
      "patterns": [
        {
          "include": "#razor-codeblock"
        },
        {
          "include": "#explicit-razor-expression"
        },
        {
          "include": "#escaped-transition"
        },
        {
          "include": "#directives"
        },
        {
          "include": "#implicit-expression"
        }
      ]
    },
    "escaped-transition": {
      "name": "constant.character.escape.razor.transition",
      "match": "@@"
    },
    "transition": {
      "match": "@",
      "name": "keyword.control.cshtml.transition"
    },
    "razor-codeblock": {
      "begin": "(@)(\\{)",
      "beginCaptures": {
        "1": {
          "patterns": [
            {
              "include": "#transition"
            }
          ]
        },
        "2": {
          "name": "keyword.control.razor.directive.codeblock.open"
        }
      },
      "patterns": [
        {
          "include": "#razor-csharp-statement"
        }
      ],
      "end": "(\\})",
      "endCaptures": {
        "1": {
          "name": "keyword.control.razor.directive.codeblock.close"
        }
      }
    },
    "razor-csharp-statement": {
      "patterns": [
        {
          "include": "#text-tag"
        },
        {
          "include": "#wellformed-html"
        },
        {
          "include": "#razor-single-line-markup"
        },
        {
          "include": "#razor-control-structures"
        },
        {
          "include": "source.cs"
        }
      ]
    },
    "razor-single-line-markup": {
      "match": "(\\@\\:)([^$]*)$",
      "captures": {
        "1": {
          "name": "keyword.control.razor.singleLineMarkup"
        },
        "2": {
          "patterns": [
            {
              "include": "#razor-control-structures"
            },
            {
              "include": "text.html.basic"
            }
          ]
        }
      }
    },
    "text-tag": {
      "begin": "(<text\\s*>)",
      "beginCaptures": {
        "1": {
          "name": "keyword.control.cshtml.transition.textTag.open"
        }
      },
      "patterns": [
        {
          "include": "#balanced-open-close-tag-body"
        },
        {
          "include": "#wellformed-html"
        }
      ],
      "end": "(</text>)",
      "endCaptures": {
        "1": {
          "name": "keyword.control.cshtml.transition.textTag.close"
        }
      }
    },
    "wellformed-html": {
      "patterns": [
        {
          "include": "#void-tag"
        },
        {
          "include": "#balanced-open-close-tag"
        }
      ]
    },
    "void-tag": {
      "name": "meta.tag.structure.$3.void.html",
      "begin": "(?i)(<)(!?)(area|base|br|col|command|embed|hr|img|input|keygen|link|meta|param|source|track|wbr)(?=\\s|/?>)",
      "beginCaptures": {
        "1": {
          "name": "punctuation.definition.tag.begin.html"
        },
        "2": {
          "name": "constant.character.escape.razor.tagHelperOptOut"
        },
        "3": {
          "name": "entity.name.tag.html"
        }
      },
      "patterns": [
        {
          "include": "text.html.basic#attribute"
        }
      ],
      "end": "/?>",
      "endCaptures": {
        "0": {
          "name": "punctuation.definition.tag.end.html"
        }
      }
    },
    "balanced-open-close-tag": {
      "begin": "(?=<([^/\\s>]+))",
      "patterns": [
        {
          "include": "#balanced-open-close-tag-start"
        },
        {
          "include": "#balanced-open-close-tag-end"
        },
        {
          "include": "#balanced-open-close-tag-body"
        }
      ],
      "end": "(?<=(</\\1>))|(/>)"
    },
    "balanced-open-close-tag-start": {
      "begin": "(<)(?!(/))([^/\\s>]+)",
      "beginCaptures": {
        "1": {
          "name": "punctuation.definition.tag.begin.html"
        },
        "2": {
          "name": "constant.character.escape.razor.tagHelperOptOut"
        },
        "3": {
          "name": "entity.name.tag.html"
        }
      },
      "patterns": [
        {
          "include": "#balanced-open-close-tag-attributes"
        }
      ],
      "end": "/?>",
      "endCaptures": {
        "0": {
          "name": "punctuation.definition.tag.end.html"
        }
      }
    },
    "balanced-open-close-tag-attributes": {
      "begin": "(?=\\s)",
      "patterns": [
        {
          "include": "#razor-control-structures"
        },
        {
          "include": "text.html.basic#attribute"
        }
      ],
      "end": "(?=/?>)"
    },
    "balanced-open-close-tag-body": {
      "begin": "(?<=([^/])>)",
      "patterns": [
        {
          "include": "#wellformed-html"
        },
        {
          "include": "$self"
        }
      ],
      "end": "(?=\\</)"
    },
    "balanced-open-close-tag-end": {
      "match": "(</)(!?)([^/\\s>]+)\\s*(>)",
      "captures": {
        "1": {
          "name": "punctuation.definition.tag.begin.html"
        },
        "2": {
          "name": "constant.character.escape.razor.tagHelperOptOut"
        },
        "3": {
          "name": "entity.name.tag.html"
        },
        "4": {
          "name": "punctuation.definition.tag.end.html"
        }
      }
    },
    "explicit-razor-expression": {
      "name": "meta.expression.explicit.cshtml",
      "begin": "(@)\\(",
      "beginCaptures": {
        "0": {
          "name": "keyword.control.cshtml"
        },
        "1": {
          "patterns": [
            {
              "include": "#transition"
            }
          ]
        }
      },
      "patterns": [
        {
          "include": "source.cs#expression"
        }
      ],
      "end": "\\)",
      "endCaptures": {
        "0": {
          "name": "keyword.control.cshtml"
        }
      }
    },
    "implicit-expression": {
      "name": "meta.expression.implicit.cshtml",
      "begin": "(@)",
      "beginCaptures": {
        "1": {
          "patterns": [
            {
              "include": "#transition"
            }
          ]
        }
      },
      "patterns": [
        {
          "include": "#await-prefix"
        },
        {
          "include": "#implicit-expression-body"
        }
      ],
      "end": "(?=[\\s<>])"
    },
    "implicit-expression-body": {
      "patterns": [
        {
          "include": "#implicit-expression-invocation-start"
        },
        {
          "include": "#implicit-expression-accessor-start"
        }
      ],
      "end": "(?=[\\s<>])"
    },
    "implicit-expression-invocation-start": {
      "begin": "([_[:alpha:]][_[:alnum:]]*)(?=\\()",
      "beginCaptures": {
        "1": {
          "name": "entity.name.function.cs"
        }
      },
      "patterns": [
        {
          "include": "#implicit-expression-continuation"
        }
      ],
      "end": "(?=[\\s<>])"
    },
    "implicit-expression-accessor-start": {
      "begin": "([_[:alpha:]][_[:alnum:]]*)",
      "beginCaptures": {
        "1": {
          "name": "variable.other.object.cs"
        }
      },
      "patterns": [
        {
          "include": "#implicit-expression-continuation"
        }
      ],
      "end": "(?=[\\s<>])"
    },
    "implicit-expression-continuation": {
      "patterns": [
        {
          "include": "#balanced-parenthesis-csharp"
        },
        {
          "include": "#balanced-brackets-csharp"
        },
        {
          "include": "#implicit-expression-invocation"
        },
        {
          "include": "#implicit-expression-accessor"
        },
        {
          "include": "#implicit-expression-extension"
        }
      ],
      "end": "(?=[\\s<>])"
    },
    "implicit-expression-accessor": {
      "match": "(?<=\\.)[_[:alpha:]][_[:alnum:]]*",
      "name": "variable.other.object.property.cs"
    },
    "implicit-expression-invocation": {
      "match": "(?<=\\.)[_[:alpha:]][_[:alnum:]]*(?=\\()",
      "name": "entity.name.function.cs"
    },
    "implicit-expression-operator": {
      "patterns": [
        {
          "include": "#implicit-expression-dot-operator"
        },
        {
          "include": "#implicit-expression-null-conditional-operator"
        },
        {
          "include": "#implicit-expression-null-forgiveness-operator"
        }
      ]
    },
    "implicit-expression-dot-operator": {
      "match": "(\\.)(?=[_[:alpha:]][_[:alnum:]]*)",
      "captures": {
        "1": {
          "name": "punctuation.accessor.cs"
        }
      }
    },
    "implicit-expression-null-conditional-operator": {
      "match": "(\\?)(?=[.\\[])",
      "captures": {
        "1": {
          "name": "keyword.operator.null-conditional.cs"
        }
      }
    },
    "implicit-expression-null-forgiveness-operator": {
      "match": "(\\!)(?=(?:\\.[_[:alpha:]][_[:alnum:]]*)|\\?|[\\[\\(])",
      "captures": {
        "1": {
          "name": "keyword.operator.logical.cs"
        }
      }
    },
    "balanced-parenthesis-csharp": {
      "begin": "(\\()",
      "beginCaptures": {
        "1": {
          "name": "punctuation.parenthesis.open.cs"
        }
      },
      "name": "razor.test.balanced.parenthesis",
      "patterns": [
        {
          "include": "source.cs"
        }
      ],
      "end": "(\\))",
      "endCaptures": {
        "1": {
          "name": "punctuation.parenthesis.close.cs"
        }
      }
    },
    "balanced-brackets-csharp": {
      "begin": "(\\[)",
      "beginCaptures": {
        "1": {
          "name": "punctuation.squarebracket.open.cs"
        }
      },
      "name": "razor.test.balanced.brackets",
      "patterns": [
        {
          "include": "source.cs"
        }
      ],
      "end": "(\\])",
      "endCaptures": {
        "1": {
          "name": "punctuation.squarebracket.close.cs"
        }
      }
    },
    "directives": {
      "patterns": [
        {
          "include": "#code-directive"
        },
        {
          "include": "#functions-directive"
        },
        {
          "include": "#page-directive"
        },
        {
          "include": "#addTagHelper-directive"
        },
        {
          "include": "#removeTagHelper-directive"
        },
        {
          "include": "#tagHelperPrefix-directive"
        },
        {
          "include": "#model-directive"
        }
      ]
    },
    "code-directive": {
      "begin": "(@)(code)\\s*",
      "beginCaptures": {
        "1": {
          "patterns": [
            {
              "include": "#transition"
            }
          ]
        },
        "2": {
          "name": "keyword.control.razor.directive.code"
        }
      },
      "patterns": [
        {
          "include": "#directive-codeblock"
        }
      ],
      "end": "(?<=})|\\s"
    },
    "functions-directive": {
      "begin": "(@)(functions)\\s*",
      "beginCaptures": {
        "1": {
          "patterns": [
            {
              "include": "#transition"
            }
          ]
        },
        "2": {
          "name": "keyword.control.razor.directive.functions"
        }
      },
      "patterns": [
        {
          "include": "#directive-codeblock"
        }
      ],
      "end": "(?<=})|\\s"
    },
    "directive-codeblock": {
      "begin": "(\\{)",
      "beginCaptures": {
        "1": {
          "name": "keyword.control.razor.directive.codeblock.open"
        }
      },
      "name": "meta.structure.razor.directive.codeblock",
      "patterns": [
        {
          "include": "source.cs"
        }
      ],
      "end": "(\\})",
      "endCaptures": {
        "1": {
          "name": "keyword.control.razor.directive.codeblock.close"
        }
      }
    },
    "page-directive": {
      "name": "meta.directive.page.cshtml",
      "match": "(@)(page)\\s+([^$]+)?",
      "captures": {
        "1": {
          "patterns": [
            {
              "include": "#transition"
            }
          ]
        },
        "2": {
          "name": "keyword.control.razor.directive.page"
        },
        "3": {
          "patterns": [
            {
              "include": "source.cs#string-literal"
            }
          ]
        }
      }
    },
    "addTagHelper-directive": {
      "name": "meta.directive.addTagHelper.razor",
      "match": "(@)(addTagHelper)\\s+([^$]+)?",
      "captures": {
        "1": {
          "patterns": [
            {
              "include": "#transition"
            }
          ]
        },
        "2": {
          "name": "keyword.control.razor.directive.addTagHelper"
        },
        "3": {
          "patterns": [
            {
              "include": "#tagHelper-directive-argument"
            }
          ]
        }
      }
    },
    "removeTagHelper-directive": {
      "name": "meta.directive.removeTagHelper.razor",
      "match": "(@)(removeTagHelper)\\s+([^$]+)?",
      "captures": {
        "1": {
          "patterns": [
            {
              "include": "#transition"
            }
          ]
        },
        "2": {
          "name": "keyword.control.razor.directive.removeTagHelper"
        },
        "3": {
          "patterns": [
            {
              "include": "#tagHelper-directive-argument"
            }
          ]
        }
      }
    },
    "tagHelperPrefix-directive": {
      "name": "meta.directive.tagHelperPrefix.razor",
      "match": "(@)(tagHelperPrefix)\\s+([^$]+)?",
      "captures": {
        "1": {
          "patterns": [
            {
              "include": "#transition"
            }
          ]
        },
        "2": {
          "name": "keyword.control.razor.directive.tagHelperPrefix"
        },
        "3": {
          "patterns": [
            {
              "include": "#tagHelper-directive-argument"
            }
          ]
        }
      }
    },
    "tagHelper-directive-argument": {
      "patterns": [
        {
          "include": "source.cs#string-literal"
        },
        {
          "include": "#unquoted-string-argument"
        }
      ]
    },
    "unquoted-string-argument": {
      "name": "string.quoted.double.cs",
      "match": "[^$]+"
    },
    "model-directive": {
      "name": "meta.directive.model.cshtml",
      "match": "(@)(model)\\s+([^$]+)?",
      "captures": {
        "1": {
          "patterns": [
            {
              "include": "#transition"
            }
          ]
        },
        "2": {
          "name": "keyword.control.razor.directive.model"
        },
        "3": {
          "patterns": [
            {
              "include": "source.cs#type"
            }
          ]
        }
      }
    },
    "await-prefix": {
      "name": "keyword.other.await.cs",
      "match": "(await)\\s+"
    }
  }
}
